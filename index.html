<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Expense Tracker Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* All your CSS remains unchanged */
  </style>
</head>
<body>
  <div class="container">
    <!-- All your UI elements remain unchanged -->
  </div>

  <script>
    const SUBMIT_URL = 'https://script.google.com/macros/s/AKfycbyk64bzWBIymraGy2c0A0bsG1mKbhdXeEmbNSKJiH3ZegWIb0SjMDmoChlT1_qUP5KZRg/exec';
    const statusEl = document.getElementById("statusMessage");

    document.getElementById('expense-date').valueAsDate = new Date();

    const expenseCategories = {
      "Clothes": ["Discretionary", "Expense", "Variable"],
      "Coffee": ["Dining Out", "Expense", "Variable"],
      "My Family": ["Living Expenses", "Expense", "FIXED"],
      "Home Expenses": ["Living Expenses", "Expense", "FIXED"],
      "Donation": ["Charity", "Expense", "Variable"],
      "Gas/Electrics": ["Living Expenses", "Expense", "Variable"],
      "Groceries": ["Living Expenses", "Expense", "Variable"],
      "Gym": ["Discretionary", "Expense", "Variable"],
      "Education Loan": ["Living Expenses", "Expense", "FIXED"],
      "Phone": ["Living Expenses", "Expense", "FIXED"],
      "Rent & Wifi": ["Living Expenses", "Expense", "FIXED"],
      "Food": ["Dining Out", "Expense", "Variable"],
      "Salary": ["Salary", "Income", "FIXED"],
      "Transport": ["Transport", "Expense", "Variable"],
      "Medicine": ["Medical", "Expense", "Variable"],
      "Transaction Cost": ["Mpesa Transaction cost", "Expense", "Variable"],
      "Miscellaneous": ["Living Expenses", "Expense", "Variable"]
    };

    document.getElementById("submitBtn").addEventListener("click", async () => {
      const amount = document.getElementById("amount").value;
      const subcategory = document.getElementById("subcategory").value;
      const mode = document.getElementById("mode").value;
      const description = document.getElementById("description").value;
      const expenseDate = document.getElementById("expense-date").value;

      if (!amount || !subcategory || !mode || !expenseDate) {
        showStatus("Please fill all required fields", "error");
        return;
      }

      const [category, categoryType, nature] = expenseCategories[subcategory] || ["", "", ""];
      const date = new Date(expenseDate).toISOString();

      const payload = {
        amount,
        subcategory,
        category,
        categoryType,
        nature,
        mode,
        description,
        date
      };

      try {
        showStatus("Saving expense...", "loading");
        const response = await fetch(SUBMIT_URL, {
          method: "POST",
          body: JSON.stringify(payload),
          headers: {
            "Content-Type": "application/json"
          }
        });

        const result = await response.json();
        if (result.success) {
          showStatus("✅ Expense added successfully!", "success");
          document.getElementById("amount").value = "";
          document.getElementById("subcategory").value = "";
          document.getElementById("mode").value = "";
          document.getElementById("description").value = "";
          document.getElementById("expense-date").valueAsDate = new Date();
        } else {
          showStatus("❌ Failed to save: " + result.error, "error");
        }
      } catch (error) {
        showStatus("❌ Error: " + error.message, "error");
      }
    });

    function showStatus(message, type) {
      statusEl.textContent = message;
      statusEl.className = `status ${type}`;
      statusEl.style.display = "block";
      setTimeout(() => statusEl.style.display = "none", 6000);
    }
  </script>
</body>
</html>
